rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Allow read/write access to game scores and leaderboard
    match /scores/{document} {
      allow create: if true; // Allow anyone to create scores
      allow read: if true;   // Allow anyone to read scores for leaderboard
      allow update: if false; // Prevent score updates (immutable)
      allow delete: if false; // Prevent score deletion
    }
    
    // Allow read/write access to game sessions
    match /sessions/{document} {
      allow create: if true; // Allow anyone to create sessions
      allow read: if true;   // Allow anyone to read sessions
      allow update: if true; // Allow session updates
      allow delete: if false; // Prevent session deletion
    }
    
    // Allow read access to game statistics
    match /stats/{document} {
      allow read: if true;
      allow write: if false; // Only server can update stats
    }
    
    // Allow read/write access to test collection for Firebase testing
    match /test-collection/{document} {
      allow create: if true; // Allow anyone to create test documents
      allow read: if true;   // Allow anyone to read test documents
      allow update: if false; // Prevent test document updates
      allow delete: if false; // Prevent test document deletion
    }
    
    // Allow read/write access to multiplayer rooms
    match /rooms/{roomId} {
      allow create: if roomId.matches('^room-[a-z]+$'); // Only allow room-[animal] format
      allow read: if true;   // Allow anyone to read room info
      allow update: if true; // Allow room state updates
      allow delete: if false; // Prevent room deletion
      
      // Allow read/write access to players in rooms
      match /players/{playerId} {
        allow create: if true; // Allow anyone to join rooms
        allow read: if true;   // Allow reading player list
        allow update: if true; // Allow player state updates
        allow delete: if true; // Allow players to leave
      }
      
      // Allow read/write access to game results (legacy)
      match /results/{resultId} {
        allow create: if true; // Allow result submission
        allow read: if true;   // Allow reading results for leaderboard
        allow update: if false; // Prevent result updates (immutable)
        allow delete: if false; // Prevent result deletion
      }
      
      // Allow read/write access to player results (current implementation)
      match /playerResults/{playerId} {
        allow create: if true; // Allow result submission
        allow read: if true;   // Allow reading results for leaderboard
        allow update: if true; // Allow result updates during game
        allow delete: if false; // Prevent result deletion
      }
      
      // Allow read/write access to game state
      match /gameState/{stateId} {
        allow create: if true; // Allow game state creation
        allow read: if true;   // Allow reading game state
        allow update: if true; // Allow game state updates
        allow delete: if false; // Prevent state deletion
      }
    }
  }
}